# 3.3 Ansible 

### Знакомство с Ansible

##### Свойства Ansible
- Декларативность
- Идемпотентность (при повторном применении давать тот же результат)
- Не требуется агент

##### Задачи Ansible
- Автоматизация установки софта
- Обеспечение повторяемости
- Масштабируемость

##### 4 концепции Ansible
- Inventory - хранение информации о машинах в сети
- Modules - непосредственно что загружается и выполняется
- Plugins - расширяют функциональность самого Ansible (например ssh)
- Api - интерфейс взаимодействия

### Простые примеры запуска


Запуск модуля на всех хостах
```bash
ansible all -i hosts.ini -m ping
```
Запуск playbook
```bash
ansible-playbook playbook.yml -i hosts.ini
```

### Структура Ansible директивы
- inventories
    - host, group_vars, host_vars
        - hosts - основной инвентарный файл, в который добавляем хосты и параметры к хостам
        - group_vars - переменные которые будут применены к определенной группе хостов
        - host_vars - добавляются переменные для определенного хоста
- roles - директория с ролями, пример название ролей nginx, php
    - Роль позволяет сгруппировать несколько задач в один конвейер
    - tasks/main.yml – основной список задач которые будет исполнять роль
    - handlers/main.yml – списки задач (обработчиков), триггеры notify
    - defaults/main.yml – переменные по умолчанию с очень низким приоритетом
    - vars/main.yml – переменные с большим приоритетом
    - files – директория с файлами которые используются в роли
    - templates – директория с шаблонами Jinja2
    - meta/main.yml – директория с метадатай об авторе, зависимостях которые использует роль
- ansible.cfg - конфигурационный файл, в котором назначаются настройки по умолчанию
- playbook.yml - файл в котором мы связываем хосты и роли которые нужно выполнять

```bash
── inventories 
│    ├── AWS 
│    │     ├── group_vars
│    │     │    ├── all 
│    │     │    └── web-servers
│    │     ├── hosts
│    │     └── host_vars
│    │           ├── hostname1
│    │           └── hostname2
│    └── Local
│          ├── group_vars
│          ├── hosts
│          └── host_vars
├── roles 
│    ├── nginx
|    |    ├──  tasks/
|    |    ├──  handlers/
|    |    |--- files/
|    |    |--- templates/
|    |    |--- vars/
|    |    |--- defaults/
|    |    |--- meta/
│    ├── grafana
│    └── common
├── ansible.cfg
├── README.md
├── grafana.yml
└── web-server.yml
```
