# 4.1 Docker

### Типы пространств имен Linux

В текущей стабильной версии ядра есть семь пространств имен:

- PID: изоляция дерева системных процессов;
- NET: изоляция сетевого стека хоста;
- MNT: изоляция точек монтирования файловой системы хоста;
- UTS: изоляция имени хоста;
- IPC: изоляция утилит межпроцессного взаимодействия (сегменты разделяемой памяти, семафоры);
- USER: изоляция ID пользователей системы;

Контейнеризация не соперничает с виртуализацией - это два разных подхода.

Различия ВМ от контейнера

- Контейнер использует ядро хостовой системы
- Если уязвимость запущена в контейнере то по сути она запущена на хосте!
- В ВМ может работать любая ОС, в контейнере – не
любая
- ВМ хорошо изолируется, контейнер - хуже

### Компоненты и сущности Docker

**Docker daemon** - cерверная часть

- Обеспечивает сборку и запуск контейнеров
- Скачивание образов
- Собирает логи
- Связывает контейнеры по сети
- И т.п.

**Docker CLI** - клиенская часть (может работать локально и по сети)

- Обеспечивает взаимодействие с Docker daemon

**Dockerfile** - инструкция по сборке docker-image

- Практически каждая команда создает новый **слой**

**Docker image** - образ, по которому будет запущен контейнер

- Упакованное приложение
- Хранится в registry
- Состоит из слоев

**Docker container** - работающий экземпляр приложения

**Docker registry** - репозиторий для хранения собранных docker image

### Основные команды

```bash
docker pull mongo

docker images

docker run -p 27017:27017 --name mydb mongo

docker ps

docker exec -it mydb /bin/bash

docker stop mydb

docker rm mydb

docker rmi mongo
```

Docker volumes

```bash
docker run -v /home/mount/data:/var/lib/mysql/data
```

Настройка сети с Docker

Network Drivers

- Bridge (контейнеры могут общаться друг с другом)
- Host (Использование хостовой сети)
- Overlay (Объединяет сети контейнеров на разных докер хостах)
- Macvlan (Присваивает каждому контейнеру физический MAC-адрес)
- None (Отключаем все сети)

```bash
docker network ls

docker network inspect net_default
```

```bash
docker-compose up

docker-compose up -d --build

docker-compose down
```
